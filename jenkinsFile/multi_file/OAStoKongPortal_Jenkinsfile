pipeline {
    parameters {
        string description: 'Branch Name', name: 'BRANCH'
        string description: "Workspace Name- ", name: 'WORKSPACE'
         }
    agent any
    stages {
        //Lint the OpenAPI spec using Insomnia CLI
        stage('Deploy to dev portal') {
            steps {
                withCredentials([string(credentialsId: 'kong_admin_api_host', variable: 'kong_admin_api_host'), string(credentialsId: 'kong_admin_token', variable: 'kong_admin_token')]) {
sh '''cat ./workspaces/default/cli.conf.yaml
sed -i \'s/kong_admin_url: http:\\/\\/localhost:8001/kong_admin_url: http:\\/\\/$kong_admin_api_host:8001/g\' ./workspaces/default/cli.conf.yaml
sed -i "s/kong_admin_token: \'\'/kong_admin_token: $kong_admin_token/g" ./workspaces/default/cli.conf.yaml
cat ./workspaces/default/cli.conf.yaml'''
                }
            }
        }
    }
    post {
        always {
              deleteDir()
        }
    }
}
